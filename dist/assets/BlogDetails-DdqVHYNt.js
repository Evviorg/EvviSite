import{a as J,r as a,j as e,L as K}from"./index-Ciz2Gt2U.js";import{I as i}from"./Instance-HTpgeh-g.js";import{l as O,m as Q,n as V,o as Z}from"./index-CYgi5MaK.js";import{u as ee}from"./use-scroll-7R0LKOWd.js";import{m as c}from"./proxy-DDY8A8je.js";import"./axios-CCb-kr4I.js";import"./resolve-element-BwSRoGbS.js";const L=()=>e.jsx("div",{className:"animate-pulse w-[90%] m-auto py-12 flex flex-col bg-white shadow-lg rounded-lg overflow-hidden mb-10",children:e.jsxs("div",{className:"w-[80%] m-auto",children:[e.jsx("div",{className:"h-60 bg-gray-300"}),e.jsxs("div",{className:"p-6 flex flex-col",children:[e.jsx("div",{className:"h-6 bg-gray-300 rounded mb-2"}),e.jsx("div",{className:"h-4 bg-gray-300 rounded mb-2"}),e.jsx("div",{className:"h-4 bg-gray-300 rounded mb-4"}),e.jsx("div",{className:"h-5 bg-gray-300 rounded"})]})]})}),ie=()=>{const{id:n}=J(),[m,q]=a.useState(null),[I,v]=a.useState(!0),[w,$]=a.useState(null),[x,_]=a.useState(""),[p,S]=a.useState(""),[h,d]=a.useState([]),[C,y]=a.useState(null),[f,B]=a.useState(""),[R,j]=a.useState(null),[u,E]=a.useState({}),[o,A]=a.useState(!1),[b,P]=a.useState(null),[T,F]=a.useState(null),[U,M]=a.useState([]),[Y,k]=a.useState(!0),[D,W]=a.useState(null),{scrollYProgress:H}=ee(),X=()=>{A(s=>!s)};a.useEffect(()=>{(async()=>{try{const l=await i.get(`/getBlogById/${n}`);q(l.data.blog),v(!1)}catch{$("Failed to load blog details"),v(!1)}})()},[n]),a.useEffect(()=>{m&&(async()=>{try{const r=(await i.post("/getAllBlogs")).data.blogs.sort(()=>.5-Math.random());M(r.slice(0,3)),k(!1)}catch(l){W("Error to fetch"),k(!1),console.log(l)}})()},[m,n]),a.useEffect(()=>{(async()=>{try{const r=(await i.get(`/getCommentByBlogId/${n}`)).data.comments||[];if(r.length>0){d(r);const t=r.reduce((N,g)=>(Array.isArray(g.replies)?N[g.comment_id]=g.replies:N[g.comment_id]=[],N),{});E(t)}else d([])}catch(l){console.error("Failed to fetch comments:",l),d([])}})()},[n]);const z=async s=>{if(s.preventDefault(),!p||!x){y("Both username and comment are required.");return}try{const l=await i.post("/createComments",{blog_id:n,username:x,comment:p});d([...h,l.data.newComment]),S(""),_(""),y(null),window.location.reload()}catch(l){console.error("Failed to post comment:",l),y("Failed to post comment. Please try again.")}},G=async(s,l)=>{if(s.preventDefault(),!f||!b){j("*Please Fill the Requirement Fields.");return}try{const r=await i.post("/replyToComment",{id:l,username:b,reply:f});E(t=>({...t,[l]:[...t[l]||[],r.data.newReply]})),B(""),j(null),F(null),window.location.reload()}catch(r){console.error("Failed to post reply:",r),j("Failed to post reply. Please try again.")}};return I?e.jsx("div",{children:e.jsx(L,{})}):w?e.jsx("div",{className:"text-red-500",children:w}):e.jsxs(e.Fragment,{children:[e.jsx(c.div,{className:"bg-t-primary fixed top-0 left-0 right-0 h-2 line",style:{scaleX:H,transform:origin}}),e.jsx("div",{className:"w-[90%] m-auto py-12 flex justify-between mb-10",children:e.jsxs("div",{className:"sm:w-[80%] m-auto",children:[m&&m.map(s=>e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("h2",{className:"text-4xl font-semibold",children:s.blog_title}),e.jsxs("div",{className:"flex gap-5 items-center",children:[e.jsx("p",{className:"text-gray-600",children:s.blog_author}),e.jsxs("p",{className:"text-gray-600",children:["Posted on"," ",new Date(s.blog_date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})]})]}),e.jsx("img",{src:`https://evvisolutions.com/blog_images/${s.blog_image}`,alt:s.blog_title,className:"min-w-full h-72 object-cover rounded-xl"}),e.jsx("div",{className:"mt-4 indent-4 text-justify ql-editor quill-content",dangerouslySetInnerHTML:{__html:s.blog_body}})]},s.id)),e.jsxs("section",{className:"mt-10",children:[e.jsx("h3",{className:"text-2xl font-semibold mb-4",children:"Comments"}),e.jsx("div",{className:"mb-6",children:h.length>0?h.map(s=>{var r;const l=((r=u[s.comment_id])==null?void 0:r.length)||0;return e.jsxs("div",{className:"mb-4 p-4 bg-slate-300/20 rounded-lg border border-gray-200 duration-300",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200 flex-shrink-0",children:e.jsx("img",{src:`https://ui-avatars.com/api/?name=${s.comment_username}&background=random`,alt:s.comment_username,className:"rounded-full w-full h-full object-cover"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"font-semibold text-lg",children:s.comment_username}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(s.comment_created_at).toLocaleString("en-IN",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"})})]})]}),e.jsxs("p",{className:"text-gray-800 text-base leading-relaxed inline-flex gap-5 items-center ",children:[s.comment,e.jsxs("button",{onClick:()=>F(t=>t===s.comment_id?null:s.comment_id),className:"text-teal-500 hover:text-teal-700 inline-flex items-center gap-1 ",children:["Reply ",e.jsx(O,{})]})]}),T===s.comment_id&&e.jsxs(c.div,{className:"flex flex-col gap-4 mb-2",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsx("input",{type:"text",className:"p-2 border border-gray-300 rounded-lg mb-2 w-full",placeholder:"Your Username",value:b,onChange:t=>P(t.target.value),required:!0}),e.jsx("textarea",{className:"w-full p-2 border border-gray-300 rounded-lg",rows:"2",placeholder:"Write a reply...",value:f,onChange:t=>B(t.target.value),required:!0,spellCheck:!0}),R&&e.jsx("p",{className:"text-red-500",children:R}),e.jsx("button",{onClick:t=>G(t,s.comment_id),className:"mt-2 btn-primary rounded-lg",children:"Submit Reply"})]}),e.jsxs("button",{onClick:X,className:"float-end inline-flex items-center gap-2 mb-2",children:[e.jsx(c.span,{initial:{rotate:o?-90:90,opacity:0},animate:{rotate:0,opacity:1},exit:{opacity:0},transition:{duration:.3},children:o?e.jsx(V,{}):e.jsx(Q,{})},o?"Up":"Down"),e.jsxs(c.span,{className:"inline-flex items-center gap-1",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsx(Z,{}),o||l]})]}),o&&u[s.comment_id]&&u[s.comment_id].length>0&&e.jsx("div",{className:"mt-8 ml-4 ",children:u[s.comment_id].map(t=>e.jsxs(c.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0},transition:{duration:.3},className:"p-2 bg-gray-100 rounded border mb-2",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex-shrink-0",children:e.jsx("img",{src:`https://ui-avatars.com/api/?name=${t.reply_username}&background=random`,alt:t.reply_username,className:"rounded-full w-full h-full object-cover"})}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("p",{className:"font-medium",children:t.reply_username}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(t.reply_created_at).toLocaleString("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"})})]})]}),e.jsx("p",{children:t.reply})]},t.reply_id))})]},s.comment_id)}):e.jsx("p",{children:"No comments yet."})}),e.jsxs("form",{onSubmit:z,className:"flex flex-col",children:[e.jsx("input",{type:"text",className:"p-2 border border-gray-300 rounded-lg mb-2",placeholder:"Your Username",value:x,onChange:s=>_(s.target.value),required:!0}),e.jsx("textarea",{className:"p-2 border border-gray-300 rounded-lg mb-2",rows:"3",placeholder:"Write a comment...",value:p,onChange:s=>S(s.target.value),required:!0}),C&&e.jsx("p",{className:"text-red-500",children:C}),e.jsx("button",{type:"submit",className:"btn-primary rounded-lg",children:"Submit Comment"})]})]}),e.jsxs("section",{className:"mt-10",children:[e.jsx("h3",{className:"text-2xl font-semibold mb-4",children:"You Might Also Like"}),Y?e.jsx(L,{}):D?e.jsx("div",{className:"text-red-500",children:D}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:U.map(s=>e.jsx("div",{className:"p-4 bg-white rounded shadow-md",children:e.jsxs(K,{to:`/blog/${s.id}`,children:[e.jsx("h4",{className:"font-semibold text-lg",children:s.blog_title}),e.jsx("p",{className:"text-gray-600",children:s.blog_author}),e.jsx("img",{src:`https://evvisolutions.com/blog_images/${s.blog_image}`,alt:s.blog_title,className:"w-full h-40 object-cover rounded mt-2"})]})},s.id))})]})]})})]})};export{ie as default};
