import{a as J,r as l,j as e,L as K}from"./index-BkbumGar.js";import{I as i}from"./Instance-DTxk0MGE.js";import{l as O,m as Q,n as V,o as Z}from"./index-D7J_3wMG.js";import{u as ee}from"./use-scroll-OEVkSwkP.js";import{m as c}from"./motion-TUijasO4.js";import"./axios-DzWr6d29.js";import"./resolve-element-BwSRoGbS.js";const L=()=>e.jsx("div",{className:"animate-pulse w-[90%] m-auto py-12 flex flex-col bg-white shadow-lg rounded-lg overflow-hidden mb-10",children:e.jsxs("div",{className:"w-[80%] m-auto",children:[e.jsx("div",{className:"h-60 bg-gray-300"}),e.jsxs("div",{className:"p-6 flex flex-col",children:[e.jsx("div",{className:"h-6 bg-gray-300 rounded mb-2"}),e.jsx("div",{className:"h-4 bg-gray-300 rounded mb-2"}),e.jsx("div",{className:"h-4 bg-gray-300 rounded mb-4"}),e.jsx("div",{className:"h-5 bg-gray-300 rounded"})]})]})}),ie=()=>{const{id:n}=J(),[m,q]=l.useState(null),[I,v]=l.useState(!0),[w,$]=l.useState(null),[x,_]=l.useState(""),[h,S]=l.useState(""),[p,d]=l.useState([]),[C,y]=l.useState(null),[f,B]=l.useState(""),[R,j]=l.useState(null),[u,E]=l.useState({}),[o,A]=l.useState(!1),[b,P]=l.useState(null),[T,F]=l.useState(null),[U,M]=l.useState([]),[Y,k]=l.useState(!0),[D,W]=l.useState(null),{scrollYProgress:H}=ee(),X=()=>{A(t=>!t)};l.useEffect(()=>{(async()=>{try{const s=await i.get(`/getBlogById/${n}`);s.data.statusCode!==700&&q(s.data.blog),v(!1)}catch{$("Failed to load blog details"),v(!1)}})()},[n]),l.useEffect(()=>{m&&(async()=>{try{const s=await i.post("/getAllBlogs");if(s.data.statusCode!==700){const r=s.data.blogs.sort(()=>.5-Math.random());M(r.slice(0,3)),k(!1)}}catch(s){W("Error to fetch"),k(!1),console.log(s)}})()},[m,n]),l.useEffect(()=>{(async()=>{try{const s=await i.get(`/getCommentByBlogId/${n}`);if(s.data.statusCode!==700){const r=s.data.comments||[];if(r.length>0){d(r);const a=r.reduce((N,g)=>(Array.isArray(g.replies)?N[g.comment_id]=g.replies:N[g.comment_id]=[],N),{});E(a)}else d([])}}catch(s){console.error("Failed to fetch comments:",s),d([])}})()},[n]);const z=async t=>{if(t.preventDefault(),!h||!x){y("Both username and comment are required.");return}try{const s=await i.post("/createComments",{blog_id:n,username:x,comment:h});s.data.statusCode!==700&&(d([...p,s.data.newComment]),S(""),_(""),y(null),window.location.reload())}catch(s){console.error("Failed to post comment:",s),y("Failed to post comment. Please try again.")}},G=async(t,s)=>{if(t.preventDefault(),!f||!b){j("*Please Fill the Requirement Fields.");return}try{const r=await i.post("/replyToComment",{id:s,username:b,reply:f});r.data.statusCode!==700&&(E(a=>({...a,[s]:[...a[s]||[],r.data.newReply]})),B(""),j(null),F(null),window.location.reload())}catch(r){console.error("Failed to post reply:",r),j("Failed to post reply. Please try again.")}};return I?e.jsx("div",{children:e.jsx(L,{})}):w?e.jsx("div",{className:"text-red-500",children:w}):e.jsxs(e.Fragment,{children:[e.jsx(c.div,{className:"bg-t-primary fixed top-0 left-0 right-0 h-2 line",style:{scaleX:H,transform:origin}}),e.jsx("div",{className:"w-[90%] m-auto py-12 flex justify-between mb-10",children:e.jsxs("div",{className:"sm:w-[80%] m-auto",children:[m&&m.map(t=>e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("h2",{className:"text-4xl font-semibold",children:t.blog_title}),e.jsxs("div",{className:"flex gap-5 items-center",children:[e.jsx("p",{className:"text-gray-600",children:t.blog_author}),e.jsxs("p",{className:"text-gray-600",children:["Posted on"," ",new Date(t.blog_date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})]})]}),e.jsx("img",{src:`http://localhost:3000/blog_images/${t.blog_image}`,alt:t.blog_title,className:"min-w-full h-72 object-cover rounded-xl"}),e.jsx("div",{className:"mt-4 text-justify ql-editor quill-content",dangerouslySetInnerHTML:{__html:t.blog_body}})]},t.id)),e.jsxs("section",{className:"mt-10",children:[e.jsx("h3",{className:"text-2xl font-semibold mb-4",children:"Comments"}),e.jsx("div",{className:"mb-6",children:p.length>0?p.map(t=>{var r;const s=((r=u[t.comment_id])==null?void 0:r.length)||0;return e.jsxs("div",{className:"mb-4 p-4 bg-slate-300/20 rounded-lg border border-gray-200 duration-300",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200 flex-shrink-0",children:e.jsx("img",{src:`https://ui-avatars.com/api/?name=${t.comment_username}&background=random`,alt:t.comment_username,className:"rounded-full w-full h-full object-cover"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"font-semibold text-lg",children:t.comment_username}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(t.comment_created_at).toLocaleString("en-IN",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"})})]})]}),e.jsxs("p",{className:"text-gray-800 text-base leading-relaxed inline-flex gap-5 items-center ",children:[t.comment,e.jsxs("button",{onClick:()=>F(a=>a===t.comment_id?null:t.comment_id),className:"text-teal-500 hover:text-teal-700 inline-flex items-center gap-1 ",children:["Reply ",e.jsx(O,{})]})]}),T===t.comment_id&&e.jsxs(c.div,{className:"flex flex-col gap-4 mb-2",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsx("input",{type:"text",className:"p-2 border border-gray-300 rounded-lg mb-2 w-full",placeholder:"Your Username",value:b,onChange:a=>P(a.target.value),required:!0}),e.jsx("textarea",{className:"w-full p-2 border border-gray-300 rounded-lg",rows:"2",placeholder:"Write a reply...",value:f,onChange:a=>B(a.target.value),required:!0,spellCheck:!0}),R&&e.jsx("p",{className:"text-red-500",children:R}),e.jsx("button",{onClick:a=>G(a,t.comment_id),className:"mt-2 btn-primary rounded-lg",children:"Submit Reply"})]}),e.jsxs("button",{onClick:X,className:"float-end inline-flex items-center gap-2 mb-2",children:[e.jsx(c.span,{initial:{rotate:o?-90:90,opacity:0},animate:{rotate:0,opacity:1},exit:{opacity:0},transition:{duration:.3},children:o?e.jsx(V,{}):e.jsx(Q,{})},o?"Up":"Down"),e.jsxs(c.span,{className:"inline-flex items-center gap-1",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsx(Z,{}),o||s]})]}),o&&u[t.comment_id]&&u[t.comment_id].length>0&&e.jsx("div",{className:"mt-8 ml-4 ",children:u[t.comment_id].map(a=>e.jsxs(c.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0},transition:{duration:.3},className:"p-2 bg-gray-100 rounded border mb-2",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex-shrink-0",children:e.jsx("img",{src:`https://ui-avatars.com/api/?name=${a.reply_username}&background=random`,alt:a.reply_username,className:"rounded-full w-full h-full object-cover"})}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("p",{className:"font-medium",children:a.reply_username}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(a.reply_created_at).toLocaleString("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"})})]})]}),e.jsx("p",{children:a.reply})]},a.reply_id))})]},t.comment_id)}):e.jsx("p",{children:"No comments yet."})}),e.jsxs("form",{onSubmit:z,className:"flex flex-col",children:[e.jsx("input",{type:"text",className:"p-2 border border-gray-300 rounded-lg mb-2",placeholder:"Your Username",value:x,onChange:t=>_(t.target.value),required:!0}),e.jsx("textarea",{className:"p-2 border border-gray-300 rounded-lg mb-2",rows:"3",placeholder:"Write a comment...",value:h,onChange:t=>S(t.target.value),required:!0}),C&&e.jsx("p",{className:"text-red-500",children:C}),e.jsx("button",{type:"submit",className:"btn-primary rounded-lg",children:"Submit Comment"})]})]}),e.jsxs("section",{className:"mt-10",children:[e.jsx("h3",{className:"text-2xl font-semibold mb-4",children:"You Might Also Like"}),Y?e.jsx(L,{}):D?e.jsx("div",{className:"text-red-500",children:D}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:U.map(t=>e.jsx("div",{className:"p-4 bg-white rounded shadow-md",children:e.jsxs(K,{to:`/blog/${t.id}`,children:[e.jsx("h4",{className:"font-semibold text-lg",children:t.blog_title}),e.jsx("p",{className:"text-gray-600",children:t.blog_author}),e.jsx("img",{src:`http://localhost:3000/blog_images/${t.blog_image}`,alt:t.blog_title,className:"w-full h-40 object-cover rounded mt-2"})]})},t.id))})]})]})})]})};export{ie as default};
